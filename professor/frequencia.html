<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lançar Frequência - Sala do Futuro</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    header {
      padding: 20px;
      text-align: left;
    }

    #topo-interface {
      background-color: #D81B60;
      padding: 10px;
      color: white;
      font-size: 24px;
    }

    #aviso .aviso-quadro {
      background-color: yellow;
      padding: 15px;
      margin: 20px 0;
      font-weight: bold;
    }

    #calendario, #horario, #alunos {
      background-color: white;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 5px;
    }

    #calendario input[type="date"],
    #horario select {
      padding: 10px;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }

    .cartela-aluno {
      background-color: white;
      border: 2px solid #4CAF50;
      border-radius: 12px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
    }

    .numero-circulo {
      background-color: #2196F3;
      color: white;
      font-weight: bold;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: inline-block;
      text-align: center;
      line-height: 30px;
    }

    td {
      text-align: center;
      padding: 10px;
    }

    .btn {
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      width: 40px;
      height: 40px;
      margin: 5px;
    }

    .btn-compareceu {
      background-color: green;
      color: white;
      font-weight: bold;
    }

    .btn-faltou {
      background-color: red;
      color: white;
      font-weight: bold;
    }

    .btn-compareceu:hover {
      background-color: darkgreen;
    }

    .btn-faltou:hover {
      background-color: darkred;
    }

    #botoes {
      text-align: center;
      margin: 20px;
    }

    #botoes button {
      background-color: #1976D2;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }

    #marcar-todos {
      background-color: #64B5F6;
    }

    #marcar-todos:hover {
      background-color: #42A5F5;
    }

    .sidebar {
      width: 150px;
      background: white;
      box-shadow: rgba(0, 0, 0, 0.1) 2px 0px 5px;
      padding-top: 10px;
      height: 100vh;
      position: fixed;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar li {
      padding: 15px;
      text-align: center;
    }

    .sidebar a {
      text-decoration: none;
      color: #424242;
      font-weight: bold;
      display: block;
      padding: 10px;
      border-radius: 8px;
      transition: background 0.3s;
    }

    .sidebar a:hover {
      background-color: #BBDEFB;
    }

    .container {
      display: flex;
    }

    main {
      margin-left: 170px;
      padding: 20px;
      width: 100%;
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA3sxrxKp0Bc6S_OGb4pWBN080yfe6T5Bc",
      authDomain: "aulamiraculosa.firebaseapp.com",
      databaseURL: "https://aulamiraculosa-default-rtdb.firebaseio.com",
      projectId: "aulamiraculosa",
      storageBucket: "aulamiraculosa.firebasestorage.app",
      messagingSenderId: "550072926782",
      appId: "1:550072926782:web:1f884d4eef514af178476f",
      measurementId: "G-00LM6P674T"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tabela = document.querySelector("#tabela-alunos tbody");

    let cartelas = [];

    function criarCartela(numero, nome) {
      const linha = document.createElement("tr");
      linha.classList.add("cartela-aluno");

      const tdNumero = document.createElement("td");
      tdNumero.innerHTML = `<div class="numero-circulo">${numero}</div>`;

      const tdNome = document.createElement("td");
      tdNome.innerText = nome;

      const tdStatus = document.createElement("td");

      const btnP = document.createElement("button");
      btnP.className = "btn btn-compareceu";
      btnP.innerText = "P";

      const btnF = document.createElement("button");
      btnF.className = "btn btn-faltou";
      btnF.innerText = "F";

      let status = "";

      btnP.onclick = () => {
        status = "Presente";
        btnP.style.opacity = "1";
        btnF.style.opacity = "0.4";
        linha.dataset.status = status;
      };

      btnF.onclick = () => {
        status = "Faltou";
        btnF.style.opacity = "1";
        btnP.style.opacity = "0.4";
        linha.dataset.status = status;
      };

      tdStatus.appendChild(btnP);
      tdStatus.appendChild(btnF);

      linha.appendChild(tdNumero);
      linha.appendChild(tdNome);
      linha.appendChild(tdStatus);

      linha.dataset.nome = nome;
      linha.dataset.status = "";

      tabela.appendChild(linha);
      cartelas.push(linha);
    }

    function carregarAlunos() {
      const alunosRef = ref(db, "Alunos");
      onValue(alunosRef, (snapshot) => {
        tabela.innerHTML = "";
        cartelas = [];
        let i = 1;

        snapshot.forEach((alunoSnap) => {
          const nome = alunoSnap.key;
          criarCartela(i, nome);
          i++;
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("marcar-todos").onclick = () => {
        document.querySelectorAll(".btn-compareceu").forEach(btn => btn.click());
      };

      document.getElementById("salvar").onclick = () => {
        const data = document.getElementById("data-lancamento").value;
        const hora = document.getElementById("horario-aula").value;

        if (!data || !hora) {
          alert("Preencha a data e o horário.");
          return;
        }

        cartelas.forEach((linha) => {
          const nome = linha.dataset.nome;
          const status = linha.dataset.status;

          if (status) {
            set(ref(db, `frequencia/${data}/${nome}`), {
              status: status,
              hora: hora
            });
          }
        });

        alert("Frequência salva com sucesso!");
      };

      carregarAlunos();
    });
  </script>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <ul>
    <a href="frequencia.html">Frequência</a>
    <a href="fechamento.html">Fechamento</a>
    <a href="registros.html">Registros</a>
    <a href="tarefas.html">Tarefas</a>
    <a href="perfil.html">Perfil</a>
      </ul>
    </div>

    <main>
      <header>
        <h1 style="color: red; font-weight: bold; font-size: 48px;">Frequência</h1>
      </header>

      <section id="topo-interface">
        <h2>Frequência</h2>
      </section>

      <section id="aviso">
        <div class="aviso-quadro">
          <strong>Aviso!</strong>
          <p>O prazo para lançamento de frequência será de até 8 dias corridos.</p>
        </div>
      </section>

      <section id="calendario">
        <h3>Calendário de Frequência</h3>
        <input type="date" id="data-lancamento" required />
      </section>

      <section id="horario">
        <h3>Horário da Aula</h3>
        <select id="horario-aula" required>
          <option value="08:00">08:00</option>
          <option value="10:00">10:00</option>
          <option value="14:00">14:00</option>
          <option value="16:00">16:00</option>
        </select>
      </section>

      <section id="alunos">
        <h3>Lista de Alunos</h3>
        <table id="tabela-alunos">
          <thead>
            <tr>
              <th>Número</th>
              <th>Nome</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <!-- Cartelas serão geradas aqui -->
          </tbody>
        </table>
      </section>

      <section id="botoes">
        <button id="marcar-todos">Marcar todos como Compareceram</button>
        <button id="salvar">Salvar Frequência</button>
      </section>
    </main>
  </div>
</body>
</html>
